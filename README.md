# Домашнее задание к занятию «Введение в Terraform» Макаров Денис

### Цели задания

1. Установить и настроить Terrafrom.
2. Научиться использовать готовый код.

------

### Чек-лист готовности к домашнему заданию

1. Скачайте и установите **Terraform** версии ~>1.8.4 . Приложите скриншот вывода команды ```terraform --version```.
2. Скачайте на свой ПК этот git-репозиторий. Исходный код для выполнения задания расположен в директории **01/src**.
3. Убедитесь, что в вашей ОС установлен docker.
4. Зарегистрируйте аккаунт на сайте https://hub.docker.com/, выполните команду docker login и введите логин, пароль.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. Репозиторий с ссылкой на зеркало для установки и настройки Terraform: [ссылка](https://github.com/netology-code/devops-materials).
2. Установка docker: [ссылка](https://docs.docker.com/engine/install/ubuntu/). 
------
### Внимание!! Обязательно предоставляем на проверку получившийся код в виде ссылки на ваш github-репозиторий!
------
Выполнение чек-листа представлено на скриншотах ниже:

На данных скриншотах представлена установка и версия terraform 

![Установка](https://github.com/user-attachments/assets/5f30e211-065d-4238-8dcd-a2452a61e525)

![Версия](https://github.com/user-attachments/assets/d5ca8629-e919-4323-89c7-7f6a1c494d4c)

На данном скриншоте представлен запущенный Docker

![Запущенный Докер](https://github.com/user-attachments/assets/0871e752-573b-4014-8733-02c716bcc5cd)

На данном скриншоте представлен зарегистрированный аккаунт на сайте https://hub.docker.com/

![Акаунт](https://github.com/user-attachments/assets/877c246f-3baa-4b36-9c34-f3aa4dfe83d6)


### Задание 1.1-8

1. Перейдите в каталог [**src**](https://github.com/netology-code/ter-homeworks/tree/main/01/src). Скачайте все необходимые зависимости, использованные в проекте. 
2. Изучите файл **.gitignore**. В каком terraform-файле, согласно этому .gitignore, допустимо сохранить личную, секретную информацию?(логины,пароли,ключи,токены итд)
3. Выполните код проекта. Найдите  в state-файле секретное содержимое созданного ресурса **random_password**, пришлите в качестве ответа конкретный ключ и его значение.
4. Раскомментируйте блок кода, примерно расположенный на строчках 29–42 файла **main.tf**.
Выполните команду ```terraform validate```. Объясните, в чём заключаются намеренно допущенные ошибки. Исправьте их.
5. Выполните код. В качестве ответа приложите: исправленный фрагмент кода и вывод команды ```docker ps```.
6. Замените имя docker-контейнера в блоке кода на ```hello_world```. Не перепутайте имя контейнера и имя образа. Мы всё ещё продолжаем использовать name = "nginx:latest". Выполните команду ```terraform apply -auto-approve```.
Объясните своими словами, в чём может быть опасность применения ключа  ```-auto-approve```. Догадайтесь или нагуглите зачем может пригодиться данный ключ? В качестве ответа дополнительно приложите вывод команды ```docker ps```.
7. Уничтожьте созданные ресурсы с помощью **terraform**. Убедитесь, что все ресурсы удалены. Приложите содержимое файла **terraform.tfstate**. 
8. Объясните, почему при этом не был удалён docker-образ **nginx:latest**. Ответ **ОБЯЗАТЕЛЬНО НАЙДИТЕ В ПРЕДОСТАВЛЕННОМ КОДЕ**, а затем **ОБЯЗАТЕЛЬНО ПОДКРЕПИТЕ** строчкой из документации [**terraform провайдера docker**](https://docs.comcloud.xyz/providers/kreuzwerker/docker/latest/docs).  (ищите в классификаторе resource docker_image )

### Выполнение задания 1.1

Перейдите в каталог [**src**] Скачайте все необходимые зависимости, использованные в проекте.

При выполнение задания использовались команды:

```
terraform plan и terraform init

```
Результат выполнения команд представлен на скриншотах ниже:

![План](https://github.com/user-attachments/assets/e303b6e5-78b3-4a42-9856-c702c4f055b3)

![Запуск](https://github.com/user-attachments/assets/366a4cba-3996-454a-ada4-cbe68a046825)

### Выполнение задания 1.2

Изучите файл **.gitignore**. В каком terraform-файле, согласно этому .gitignore, допустимо сохранить личную, секретную информацию?(логины,пароли,ключи,токены итд)

Файл **.gitignore**. представлен на скриншоте ниже:

![Секрет](https://github.com/user-attachments/assets/45b31aa3-1a11-4c25-9547-409ce0bbeb99)

Из данного скриншота мы видим, что секретная информация хранится в **personal.auto.tfvars**

### Выполнение задания 1.3

Выполните код проекта. Найдите  в state-файле секретное содержимое созданного ресурса **random_password**, пришлите в качестве ответа конкретный ключ и его значение.

Для выполнения данного задания использовались команды 

```

terraform plan и terraform apply -auto-approve

```
Результат выполнения команд и файл **terraform.tfstate** представлены на скриншотах ниже:

![проверка](https://github.com/user-attachments/assets/1f0140c7-b46e-411b-b6ef-794f76cb33b9)

![Плай](https://github.com/user-attachments/assets/a9e35bc7-e4ef-4dc1-848e-81b8f5b53dd9)

На данном скриншоте выделен найденный ключ в поле "Result"
![Ключ](https://github.com/user-attachments/assets/384adf7f-be73-4c5a-8bc4-d445b769c511)

### Выполнение задания 1.4

Раскомментируйте блок кода, примерно расположенный на строчках 29–42 файла **main.tf**.
Выполните команду ```terraform validate```. Объясните, в чём заключаются намеренно допущенные ошибки. Исправьте их.

При проверке файла **main.tf** были обнаружены следующие ошибки:

  - "docker_image" - ресурсу не было назначено имя;
  - "docker_container" - имя контайнера начиналось с цифры 1, что не допустимо в названиях Docker containers.

Ошибка при запуске представлена на скриншоте ниже:

![ошибка](https://github.com/user-attachments/assets/80a5f337-9948-4f1d-82dc-a02b65854b11)

Были внесены исправления.

Результат выполнения представлен на скриншоте ниже:

![выполнение](https://github.com/user-attachments/assets/23be27cc-3578-4ac4-8560-a04f34f05dcf)

### Выполнение задания 1.5

Выполните код. В качестве ответа приложите: исправленный фрагмент кода и вывод команды ```docker ps```.

Исправленный код представлен ниже:

```
resource "docker_image" "nginx" {
  name         = "nginx:latest"
  keep_locally = true
}

resource "docker_container" "nginx" {
  image = docker_image.nginx.image_id
  name  = "example_${random_password.random_string.result}"

  ports {
    internal = 80
    external = 9090
  }
}
```

Вывод команды ```docker ps``` представлен на скриншоте ниже:

![контейнер](https://github.com/user-attachments/assets/09109ba1-35b3-459e-8117-ce9e87e3e849)

### Выполнение задания 1.6

Замените имя docker-контейнера в блоке кода на ```hello_world```. Не перепутайте имя контейнера и имя образа. Мы всё ещё продолжаем использовать name = "nginx:latest". Выполните команду ```terraform apply -auto-approve```.
Объясните своими словами, в чём может быть опасность применения ключа  ```-auto-approve```. Догадайтесь или нагуглите зачем может пригодиться данный ключ? В качестве ответа дополнительно приложите вывод команды ```docker ps```.

Была произведено переименование контейнера, результат представлен ниже:

```
resource "docker_container" "nginx" {
  name  = "hello_world"
  image = "nginx:latest"
  ...
}
```
На скриншоте ниже terraform увидел изменение:

![переименование](https://github.com/user-attachments/assets/82aa7989-4c75-426c-a2d3-9451a3379c42)

![выполнение 2](https://github.com/user-attachments/assets/371a69b2-b7a3-4600-9d80-99f8d15b1bf8)

Результат переименования представлен на скриншоте ниже:

![конейнер изм](https://github.com/user-attachments/assets/78ad7432-2e20-424c-86f2-e45dbdad5aa9)

Опасность использования ключа -auto-approve: Ключ -auto-approve автоматически подтверждает все изменения, что может привести к случайному удалению или изменению ресурсов без моего подтверждения.

### Выполнение задания 1.7 

 Уничтожьте созданные ресурсы с помощью **terraform**. Убедитесь, что все ресурсы удалены. Приложите содержимое файла **terraform.tfstate**.

 Для выполнения данного задания использовалась команда 

```
terraform destroy -auto-approve
```
Результат выполнения команды представлен на скриншоте ниже:

![удаление](https://github.com/user-attachments/assets/d9301880-3ba0-4ae3-b768-1fd54d17f123)

Файл **terraform.tfstate** представлен на скриншоте ниже:

![state](https://github.com/user-attachments/assets/22669280-a331-4959-8d6f-1664782826c9)

### Выполнение задания 1.8

Объясните, почему при этом не был удалён docker-образ **nginx:latest**. Ответ **ОБЯЗАТЕЛЬНО НАЙДИТЕ В ПРЕДОСТАВЛЕННОМ КОДЕ**, а затем **ОБЯЗАТЕЛЬНО ПОДКРЕПИТЕ** строчкой из документации [**terraform провайдера docker**](https://docs.comcloud.xyz/providers/kreuzwerker/docker/latest/docs).




















